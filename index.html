<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Question Timer — Full Summary</title>
<style>
  :root{
    --bg:#1f1f1f; --panel:#222; --muted:#9aa0a6; --accent:#bfbfbf;
    --primary:#6ee7b7; --danger:#ff6b6b; --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#eee}
  .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box}

  /* Timer Card */
  .card{width:380px;max-width:94vw;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);text-align:center;
  }
  .top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .qcount{font-size:20px;color:var(--accent);letter-spacing:0.6px}
  .totaltime{font-size:13px;color:var(--muted)}

  .circle-wrap{display:flex;align-items:center;justify-content:center;position:relative;margin:6px 0 14px}
  .svg-circle{width:260px;height:260px;position:relative}
  .center-label{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none;text-align:center}
  .center-main{font-size:28px;color:#d7d7d7;font-weight:600;letter-spacing:0.4px}
  .center-sub{font-size:12px;color:var(--muted);margin-top:6px}
  .time-row{margin-top:12px;font-size:18px;color:var(--accent);display:flex;justify-content:center;gap:8px;align-items:center}
  .time-row .small{color:var(--muted);font-size:15px}

  .controls{display:flex;justify-content:space-between;align-items:center;margin-top:18px}
  .circle-btn{width:72px;height:72px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:#ddd;font-size:20px;cursor:pointer}
  .circle-btn:active{transform:scale(.98)}
  .btn-label{font-size:11px;color:var(--muted);margin-top:8px}

  .middle-actions{display:flex;gap:14px;align-items:center;justify-content:center}
  .attempt-btn{padding:8px 14px;border-radius:10px;background:#2a2a2a;border:1px solid rgba(255,255,255,0.03);color:#ddd;cursor:pointer;font-weight:600}
  .hud{display:flex;justify-content:space-between;margin-top:12px;align-items:center;gap:8px}
  .chip{background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:10px;color:var(--muted);font-size:13px}

  .settings{margin-top:14px;text-align:left;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .settings input{width:84px;padding:8px;background:#151515;border:1px solid rgba(255,255,255,0.03);color:#ddd;border-radius:8px;font-size:14px}
  .settings button{padding:8px 12px;border-radius:10px;background:#3b3b3b;border:none;color:#fff;cursor:pointer;font-weight:600}

  .time-alert{margin-top:12px;color:var(--danger);font-weight:700;font-size:16px;opacity:0;transition:opacity 1.2s ease, transform .4s ease}
  .time-alert.show{opacity:1;transform:translateY(-4px)}
  .pulse {animation:pulseRing 1s infinite ease-in-out}
  @keyframes pulseRing{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}

  /* Summary (full screen) */
  .summary-screen{position:fixed;inset:0;background:rgba(10,10,10,0.9);display:none;align-items:center;justify-content:center;z-index:999;padding:20px}
  .summary-card{width:880px;max-width:98vw;background:#0f0f0f;border-radius:14px;padding:20px;color:#eee;box-shadow:0 30px 60px rgba(0,0,0,0.7);overflow:hidden;display:flex;gap:18px}
  .summary-left{width:360px;min-width:300px;padding:10px;border-right:1px solid rgba(255,255,255,0.03)}
  .summary-right{flex:1;padding:12px;max-height:70vh;overflow:auto}
  .stat{margin-bottom:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
  .stat h3{margin:0 0 6px 0;font-size:14px;color:var(--muted)}
  .stat p{margin:0;font-size:22px;font-weight:700;color:#fff}
  .times-list{margin-top:8px}
  .times-list .row{display:flex;justify-content:space-between;padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
  .summary-actions{display:flex;gap:10px;margin-top:12px}
  .summary-actions button{padding:8px 12px;border-radius:8px;border:none;background:#2b2b2b;color:#fff;cursor:pointer}
  .small-muted{color:var(--muted);font-size:13px}
  @media (max-width:920px){.summary-card{flex-direction:column}.summary-left{width:100%;border-right:none;border-bottom:1px solid rgba(255,255,255,0.03)}}
</style>
</head>
<body>
<div class="app">
  <!-- MAIN TIMER CARD -->
  <div class="card" id="timerCard" role="application" aria-label="Question timer">
    <div class="top-row">
      <div class="qcount" id="qcount">1 / 100</div>
      <div class="totaltime" id="totaltime">Total: 00:00</div>
    </div>

    <div class="circle-wrap">
      <svg class="svg-circle" id="svgRoot" viewBox="0 0 120 120" role="img" aria-label="circular timer">
        <circle cx="60" cy="60" r="52" stroke="rgba(255,255,255,0.06)" stroke-width="6" fill="transparent"/>
        <circle id="progressRing" cx="60" cy="60" r="52" stroke="#6ee7b7" stroke-width="6" stroke-linecap="round" fill="transparent"
                transform="rotate(-90 60 60)" stroke-dasharray="326.7256" stroke-dashoffset="326.7256"></circle>
        <circle cx="60" cy="60" r="48.4" stroke="rgba(0,0,0,0.6)" stroke-width="9" fill="transparent"></circle>
      </svg>

      <div class="center-label" style="width:220px;pointer-events:none;">
        <div class="center-main" id="centerMain">Start</div>
        <div class="center-sub" id="centerSub">Tap the circle to start</div>
      </div>

      <!-- clickable area (when running this will show "Next" text inside the centerMain) -->
      <button id="circleBtn" aria-label="Start/Next"
              style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:220px;height:220px;border-radius:50%;
              background:transparent;border:none;cursor:pointer;"></button>
    </div>

    <div class="time-row">
      <div class="small" id="elapsed">00:00</div>
      <div>/</div>
      <div id="targetTime">05:00</div>
    </div>

    <div class="controls">
      <div style="display:flex;flex-direction:column;align-items:center">
        <button class="circle-btn" id="pauseBtn" title="Pause / Resume"><span style="font-size:20px">⏸</span></button>
        <div class="btn-label">Pause</div>
      </div>

      <div class="middle-actions">
        <button class="attempt-btn" id="attemptBtn" title="Record attempt">Attempt ➕ <span style="opacity:0.9;margin-left:8px" id="attemptCount">0</span></button>
        <button class="circle-btn" id="stopBtn" title="Stop quiz (show summary)"><span style="font-size:20px">⏹</span></button>
      </div>

      <div style="display:flex;flex-direction:column;align-items:center">
        <div style="width:72px;height:72px;border-radius:50%"></div>
        <div class="btn-label">&nbsp;</div>
      </div>
    </div>

    <div class="hud" style="margin-top:12px">
      <div class="chip">Question: <strong id="hudQuestion">1</strong></div>
      <div class="chip">Attempts: <strong id="hudAttempts">0</strong></div>
      <div class="chip">Saved time/q: <strong id="hudSaved">05:00</strong></div>
    </div>

    <div class="time-alert" id="timeAlert" aria-live="polite">⏳ TIME UP!</div>

    <div class="settings" style="margin-top:14px">
      <div class="row">
        <label style="color:var(--muted);font-size:13px">Minutes / Q</label>
        <input id="minutesInput" type="number" min="1" inputmode="numeric" />
      </div>
      <div class="row">
        <label style="color:var(--muted);font-size:13px">Total Q</label>
        <input id="totalInput" type="number" min="1" inputmode="numeric" />
      </div>
      <div style="display:flex;align-items:center">
        <button id="saveBtn">Save</button>
      </div>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div class="note small-muted">Auto-next on Next • Attempts reset per question</div>
      <div style="display:flex;gap:10px;align-items:center">
        <button id="resetTotals" style="background:#3b3b3b;padding:8px;border-radius:8px;border:none;color:#fff;cursor:pointer">Reset</button>
      </div>
    </div>
  </div>
</div>

<!-- SUMMARY FULLSCREEN -->
<div class="summary-screen" id="summaryScreen" role="dialog" aria-modal="true">
  <div class="summary-card" role="document">
    <div class="summary-left">
      <h2 style="margin:0 0 8px 0">Quiz Summary</h2>
      <p class="small-muted" style="margin:0 0 12px 0">Results for recorded questions</p>

      <div class="stat">
        <h3>Total time</h3>
        <p id="sumTotal">00:00</p>
      </div>
      <div class="stat">
        <h3>Average</h3>
        <p id="sumAvg">00:00</p>
      </div>
      <div class="stat">
        <h3>Longest</h3>
        <p id="sumMax">00:00</p>
      </div>
      <div class="stat">
        <h3>Shortest</h3>
        <p id="sumMin">00:00</p>
      </div>

      <div class="summary-actions">
        <button id="restartBtn">Restart Quiz</button>
        <button id="closeSummary">Close</button>
      </div>

      <p style="margin-top:12px" class="small-muted">Total questions: <span id="sumCount">0</span></p>
    </div>

    <div class="summary-right">
      <h3 style="margin-top:0">Time per question</h3>
      <div class="times-list" id="timesList"></div>
    </div>
  </div>
</div>

<!-- audio -->
<audio id="alarmSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
/* ---------- State & storage keys ---------- */
const STORAGE = {
  minutes: 'qt_minutesPerQ',
  totalQ: 'qt_totalQuestions',
  curQ: 'qt_curQuestion',
  accum: 'qt_totalAccum',
  times: 'qt_questionTimes' // JSON array of seconds per question (recorded ones)
};

let curQuestion = parseInt(localStorage.getItem(STORAGE.curQ)) || 1;
let totalQuestions = parseInt(localStorage.getItem(STORAGE.totalQ)) || 100;
let minutesPerQ = parseInt(localStorage.getItem(STORAGE.minutes)) || 5;
let totalAccumSeconds = parseInt(localStorage.getItem(STORAGE.accum)) || 0;
let questionTimes = JSON.parse(localStorage.getItem(STORAGE.times) || '[]');

let running = false;
let seconds = 0;            // elapsed seconds for current question
let extraActive = false;
let attemptCount = 0;
let intervalId = null;

/* ---------- DOM ---------- */
const qcountEl = document.getElementById('qcount');
const hudQuestion = document.getElementById('hudQuestion');
const hudAttempts = document.getElementById('hudAttempts');
const hudSaved = document.getElementById('hudSaved');
const totaltimeEl = document.getElementById('totaltime');

const centerMain = document.getElementById('centerMain');
const centerSub = document.getElementById('centerSub');

const elapsedEl = document.getElementById('elapsed');
const targetEl = document.getElementById('targetTime');
const minutesInput = document.getElementById('minutesInput');
const totalInput = document.getElementById('totalInput');
const saveBtn = document.getElementById('saveBtn');
const attemptBtn = document.getElementById('attemptBtn');
const attemptCountEl = document.getElementById('attemptCount');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const circleBtn = document.getElementById('circleBtn');
const progressRing = document.getElementById('progressRing');
const timeAlert = document.getElementById('timeAlert');
const resetTotals = document.getElementById('resetTotals');

const summaryScreen = document.getElementById('summaryScreen');
const sumTotal = document.getElementById('sumTotal');
const sumAvg = document.getElementById('sumAvg');
const sumMax = document.getElementById('sumMax');
const sumMin = document.getElementById('sumMin');
const timesList = document.getElementById('timesList');
const sumCount = document.getElementById('sumCount');
const restartBtn = document.getElementById('restartBtn');
const closeSummary = document.getElementById('closeSummary');

const progressR = 52;
const CIRC = 2 * Math.PI * progressR;
progressRing.style.strokeDasharray = `${CIRC}`;
progressRing.style.strokeDashoffset = `${CIRC}`;

const alarmSound = document.getElementById('alarmSound');

/* ---------- Helpers ---------- */
function pad(n){ return n<10 ? '0'+n : ''+n; }
function fmt(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${pad(m)}:${pad(s)}`; }
function saveAll(){
  localStorage.setItem(STORAGE.minutes, String(minutesPerQ));
  localStorage.setItem(STORAGE.totalQ, String(totalQuestions));
  localStorage.setItem(STORAGE.curQ, String(curQuestion));
  localStorage.setItem(STORAGE.accum, String(totalAccumSeconds));
  localStorage.setItem(STORAGE.times, JSON.stringify(questionTimes));
}

/* ---------- UI sync ---------- */
function refreshUI(){
  qcountEl.textContent = `${curQuestion} / ${totalQuestions}`;
  hudQuestion.textContent = curQuestion;
  hudAttempts.textContent = attemptCount;
  attemptCountEl.textContent = attemptCount;
  minutesInput.value = minutesPerQ;
  totalInput.value = totalQuestions;
  hudSaved.textContent = fmt(minutesPerQ * 60);
  elapsedEl.textContent = fmt(seconds);
  targetEl.textContent = fmt(minutesPerQ * 60);
  totaltimeEl.textContent = `Total: ${fmt(totalAccumSeconds)}`;

  // center label: when running show "Next" (per request), otherwise Start/Paused
  if(running){
    centerMain.textContent = 'Next';
    centerSub.textContent = 'Click to save & go next';
  } else if(!running && seconds === 0){
    centerMain.textContent = 'Start';
    centerSub.textContent = 'Tap the circle to start';
  } else {
    centerMain.textContent = 'Resume';
    centerSub.textContent = 'Tap the circle to resume';
  }

  // ring progress
  const limit = minutesPerQ * 60;
  const progress = Math.min(seconds / Math.max(limit,1), 1);
  const offset = CIRC * (1 - progress);
  progressRing.style.strokeDashoffset = `${offset}`;

  if(extraActive){
    progressRing.style.stroke = '#ff6b6b';
    progressRing.classList.add('pulse');
  } else {
    progressRing.style.stroke = '#6ee7b7';
    progressRing.classList.remove('pulse');
  }
}

/* ---------- Timer logic ---------- */
function startInterval(){
  if(intervalId) return;
  intervalId = setInterval(() => {
    seconds += 1;
    totalAccumSeconds += 1;
    // periodic save
    if(totalAccumSeconds % 5 === 0) saveAll();

    const limit = minutesPerQ * 60;
    if(seconds === limit){
      triggerTimeUp();
    }
    if(seconds > limit){
      extraActive = true;
      timeAlert.textContent = `⏳ Extra: ${fmt(seconds - limit)}`;
    }
    refreshUI();
  },1000);
}

function stopInterval(){
  if(intervalId){ clearInterval(intervalId); intervalId = null; }
}

function startTimer(){
  if(running) return;
  running = true;
  extraActive = false;
  timeAlert.classList.remove('show');
  startInterval();
  refreshUI();
}

function pauseTimer(){
  running = false;
  stopInterval();
  refreshUI();
}

/* ---------- Next behavior (records current question time, moves to next or summary) ---------- */
function recordCurrentQuestion(){
  // Decide whether to record: if seconds > 0 OR attempts>0 -> record
  if(seconds > 0 || attemptCount > 0){
    questionTimes.push(seconds);
    saveAll();
  } else {
    // If nothing happened, still push 0 to keep question count consistent? We'll still push 0 to record answered zero-time
    questionTimes.push(0);
    saveAll();
  }
}

function nextQuestionAction(){
  // Stop running timer for this question, record its time, then either go to next or end quiz
  stopInterval();
  running = false;
  // record current question
  recordCurrentQuestion();

  // If this was final question -> show summary
  if(curQuestion >= totalQuestions){
    // show summary (auto-stop)
    showSummary();
    return;
  }

  // Otherwise advance to next
  curQuestion++;
  seconds = 0;
  attemptCount = 0;
  extraActive = false;
  timeAlert.classList.remove('show');
  saveAll();
  refreshUI();
}

/* ---------- Stop (END QUIZ) ---------- */
function stopQuizAndShowSummary(){
  // if current question has any elapsed time or attempts, record it
  stopInterval();
  running = false;
  if(seconds > 0 || attemptCount > 0){
    recordCurrentQuestion();
  }
  showSummary();
}

/* ---------- TimeUp ---------- */
function triggerTimeUp(){
  try{ alarmSound.currentTime = 0; alarmSound.play().catch(()=>{}); }catch(e){}
  if(navigator.vibrate) navigator.vibrate([200,100,200]);
  timeAlert.textContent = '⏳ TIME UP!';
  timeAlert.classList.add('show');
  extraActive = true;
  refreshUI();
}

/* ---------- Summary UI ---------- */
function computeStats(arr){
  if(!arr || arr.length===0) return {sum:0,avg:0,max:0,min:0};
  const sum = arr.reduce((a,b)=>a+b,0);
  const avg = Math.round(sum / arr.length);
  const max = Math.max(...arr);
  const min = Math.min(...arr);
  return {sum,avg,max,min};
}

function showSummary(){
  // ensure saved state
  saveAll();
  // stop timers
  stopInterval();
  running = false;

  // compute stats on recorded questionTimes
  const stats = computeStats(questionTimes);
  sumTotal.textContent = fmt(stats.sum);
  sumAvg.textContent = fmt(stats.avg);
  sumMax.textContent = fmt(stats.max);
  sumMin.textContent = fmt(stats.min);
  sumCount.textContent = questionTimes.length;

  // populate list
  timesList.innerHTML = '';
  if(questionTimes.length === 0){
    const noRow = document.createElement('div'); noRow.className='row'; noRow.textContent='No recorded questions yet.'; timesList.appendChild(noRow);
  } else {
    questionTimes.forEach((t,i)=>{
      const row = document.createElement('div'); row.className='row';
      const left = document.createElement('div'); left.textContent = `Q${i+1}`;
      const right = document.createElement('div'); right.textContent = fmt(t);
      row.appendChild(left); row.appendChild(right);
      timesList.appendChild(row);
    });
  }

  // show summary screen full-screen
  summaryScreen.style.display = 'flex';
}

/* ---------- Reset / Restart ---------- */
function restartQuiz(){
  if(!confirm('Restart quiz and clear recorded times?')) return;
  // clear stored progress
  questionTimes = [];
  curQuestion = 1;
  seconds = 0;
  attemptCount = 0;
  totalAccumSeconds = 0;
  extraActive = false;
  saveAll();
  summaryScreen.style.display = 'none';
  refreshUI();
}

function closeSummaryScreen(){
  summaryScreen.style.display = 'none';
  // show timer UI (timerCard already visible)
  refreshUI();
}

/* ---------- Event handlers ---------- */
circleBtn.addEventListener('click', ()=>{
  // If running -> act as Next
  if(running){
    nextQuestionAction();
  } else {
    // Not running -> start/resume
    startTimer();
  }
});

pauseBtn.addEventListener('click', ()=> {
  if(running) pauseTimer(); else startTimer();
});

stopBtn.addEventListener('click', ()=> {
  // Stop entire quiz and show summary
  stopQuizAndShowSummary();
});

attemptBtn.addEventListener('click', ()=> {
  attemptCount++;
  hudAttempts.textContent = attemptCount;
  attemptCountEl.textContent = attemptCount;
});

saveBtn.addEventListener('click', ()=>{
  const m = parseInt(minutesInput.value) || minutesPerQ;
  const t = parseInt(totalInput.value) || totalQuestions;
  minutesPerQ = Math.max(1, m);
  totalQuestions = Math.max(1, t);
  saveAll();
  // quick feedback
  saveBtn.textContent = 'Saved ✓';
  setTimeout(()=> saveBtn.textContent = 'Save', 800);
  refreshUI();
});

resetTotals.addEventListener('click', ()=>{
  if(!confirm('Reset total accumulated time and progress (keeps settings)?')) return;
  totalAccumSeconds = 0;
  curQuestion = 1;
  seconds = 0;
  attemptCount = 0;
  questionTimes = [];
  extraActive = false;
  saveAll();
  refreshUI();
});

/* summary screen controls */
restartBtn.addEventListener('click', restartQuiz);
closeSummary.addEventListener('click', closeSummaryScreen);

/* keyboard */
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){ e.preventDefault(); if(running) pauseTimer(); else startTimer(); }
  if(e.key === 'n' || e.key === 'N'){ // quick Next via keyboard when running
    if(running) nextQuestionAction();
  }
});

/* persist before unload */
window.addEventListener('beforeunload', saveAll);

/* ---------- Init ---------- */
function init(){
  minutesInput.value = minutesPerQ;
  totalInput.value = totalQuestions;
  saveAll();
  refreshUI();
}
init();
</script>
</body>
</html>
